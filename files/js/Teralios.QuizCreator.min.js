define("Teralios/QuizCreator/Result",["Ajax","Language","StringUtil"],function(t,e,i){"use strict";return{init:function(t,e,i,s,n){this._result=t,this._score=e,this._timeTotal=i,this._quizData=s,this._gameContainer=n},showResult:function(){"competition"===this._quizData.type?this._loadResult():this._renderResultOffline()},_loadResult:function(){t.api(this,{objectIDs:[this._quizData.quizID],parameters:{score:this._score,result:this._result,timeTotal:this._timeTotal}})},_renderResultLive:function(t){this._renderBase(),this._renderScore(t)},_renderResultOffline:function(){this._renderBase()},_buildBaseContainer:function(){this._gameContainer.innerHTML='<div class="result"></div>',this._resultContainer=elBySel(".result",this._gameContainer)},_renderBase:function(){this._buildBaseContainer(),this._renderGoal()},_renderGoal:function(){var t=this._quizData.goalList;if(t.length>0){for(var e=!1,s=0;s<t.length;s++)Number(t[s].points)<=Number(this._score)&&(e=t[s]);if(!1!==e){var n='<span class="icon icon96 '+e.icon+'"></span>';n+='<h3 class="name">'+i.escapeHTML(e.title)+"</h3>",""!==e.description&&(n+='<p class="small">'+i.escapeHTML(e.description)+"</p>");var a=elCreate("div");a.classList.add("goal"),a.innerHTML=n,this._resultContainer.appendChild(a)}}},_renderScore:function(t){console.log(t);var s='<p class="player">'+this._score+" "+e.get("wcf.quizCreator.game.score")+"</p>";if(t.players>0&&(s+='<div class="average"><p>âŒ€</p>',s+="<p> "+i.formatNumeric(t.scoreSum/t.players)+" "+e.get("wcf.quizCreator.game.score")+"</p>"),0===t.playerWorse)s+="<p>"+e.get("wcf.quizCreator.game.lastPosition")+"</p>";else{var n=i.formatNumeric(100*t.playerWorse,2);s+=e.get("wcf.quizCreator.game.otherPlayers",{percent:n})}var a=elCreate("div");a.classList.add("score"),a.innerHTML=s,this._resultContainer.appendChild(a)},_ajaxSetup:function(){return{data:{actionName:"finishGame",className:"wcf\\data\\quiz\\QuizAction"}}},_ajaxSuccess:function(t){this._renderResultLive(t.returnValues)},_ajaxFailure:function(){this._renderResultOffline()}}}),define("Teralios/QuizCreator/Game",["StringUtil","Language","Teralios/QuizCreator/Result"],function(t,e,i){"use strict";function s(t,e){this.init(t,e)}var n=["quizID","type","questions","questionList","goalList"],a=["A","B","C","D"],r=[10,5,1],o=[5,15,0];return s.prototype={init:function(t,e){this._gameContainer=e,this._data=t,this._checkData()&&(this._gameCanStart=!0)},buildGame:function(){!0===this._gameCanStart&&this._createBaseHTML()},startGame:function(){elRemove(this._buttonStart),this._buildGameHTML(),this._questionIndex=0,this._score=0,this._gameResult=[],this._timeTotal=0,this._showQuestion(!0)},answer:function(t){this._toggleButtons(!1),this._stopClock();var i=elData(t.target,"value");i===this._currentQuestion.answer?(t.target.classList.add("correct"),this._score+=this._questionScoreValue,this._updateScoreContainer()):t.target.classList.add("wrong"),this._gameResult[this._questionIndex]={answer:i,time:this._time},this._timeTotal+=this._time,this._questionIndex+1>=this._data.questions&&(this._buttonNext.textContent=e.get("wcf.quizCreator.game.finish")),this._buttonNext.style.visibility="visible",this._updateClockContainer(!1)},next:function(){this._buttonNext.style.visibility="hidden",this._questionIndex++,this._questionIndex>=this._data.questions?this._finishGame():this._showQuestion(!1)},_checkData:function(){for(var t=!1,i=n.length,s=0;s<i;s++)if(!1===this._data.hasOwnProperty(n[s])){t=!0;break}return 0===this._data.questionList.length&&(t=!0),!0===t&&this._printError(e.get("wcf.quizCreator.game.missingData")),!t},_createBaseHTML:function(){this._headerContainer=elCreate("div"),this._contentContainer=elCreate("div"),this._footerContainer=elCreate("div"),this._headerContainer.className="gameHeader",this._contentContainer.className="gameContent",this._footerContainer.className="gameFooter",this._gameContainer.innerHTML="",this._gameContainer.appendChild(this._headerContainer),this._gameContainer.appendChild(this._contentContainer),this._gameContainer.appendChild(this._footerContainer),this._buttonStart=elCreate("button"),this._buttonStart.textContent=e.get("wcf.quizCreator.game.start"),this._buttonStart.addEventListener(WCF_CLICK_EVENT,this.startGame.bind(this)),this._contentContainer.appendChild(this._buttonStart)},_buildGameHTML:function(){var t="<b>"+e.get("wcf.quizCreator.game.questions")+"</b> ";t+='<span class="currentQuestion"> '+this._questionIndex+"</span> / "+this._data.questions;var i=elCreate("div");i.className="questionCounter",i.innerHTML=t,this._questionCounterContainer=elBySel(".currentQuestion",i),this._headerContainer.appendChild(i);var s=elCreate("div");s.className="clock",s.innerHTML="<b>"+e.get("wcf.quizCreator.game.time")+'</b> <span class="seconds"></span> ',this._timeContainer=elBySel(".seconds",s),this._headerContainer.appendChild(s);var n=elCreate("div");n.className="currentQuestionValue",n.innerHTML='+ <span class="questionValue"></span> <b>'+e.get("wcf.quizCreator.game.points")+"</b>",this._questionValueContainer=elBySel(".questionValue",n),this._headerContainer.appendChild(n),this._footerContainer.innerHTML='<p><span class="score"></span> '+e.get("wcf.quizCreator.game.score")+"</p>",this._scoreContainer=elBySel(".score",this._footerContainer),this._questionText=elCreate("p"),this._questionText.className="question",elHide(this._questionText),this._contentContainer.appendChild(this._questionText),this._answerList=this._buildQuestionField(),elHide(this._answerList),this._contentContainer.appendChild(this._answerList),this._buttonNext=elCreate("button"),this._buttonNext.textContent=e.get("wcf.quizCreator.game.next"),this._buttonNext.addEventListener(WCF_CLICK_EVENT,this.next.bind(this)),this._buttonNext.style.visibility="hidden",this._contentContainer.appendChild(this._buttonNext)},_buildQuestionField:function(){var t=elCreate("ul");t.className="answerList",shuffle(a),this._buttons=[];for(var e=0;e<4;e++){var i=a[e],s=elCreate("button");s.className="answer",elData(s,"value",i),s.addEventListener(WCF_CLICK_EVENT,this.answer.bind(this));var n=elCreate("li");n.appendChild(s),t.appendChild(n),this._buttons[e]=s}return t},_toggleButtons:function(t){for(var e=0;e<4;e++)!0===t?(this._buttons[e].removeAttribute("disabled"),this._buttons[e].classList.remove("wrong","correct")):this._buttons[e].setAttribute("disabled","disabled")},_showQuestion:function(e){!0===e&&(elShow(this._questionText),elShow(this._answerList),this._contentContainer.classList.add("borderTop"),this._footerContainer.classList.add("borderTop"),this._updateScoreContainer()),this._currentQuestion=this._data.questionList[this._questionIndex],this._questionText.textContent=t.escapeHTML(this._currentQuestion.question);for(var i=0;i<4;i++){var s="option"+elData(this._buttons[i],"value");this._buttons[i].textContent=t.escapeHTML(this._currentQuestion[s])}this._toggleButtons(!0),this._questionCounterContainer.textContent=String(this._questionIndex+1),this._startClock()},_startClock:function(){if("competition"===this._data.type){for(var t=1;t<=3;t++)this._timeContainer.classList.remove("status"+t);this._clockStatus=0,this._timeContainer.classList.add("status"+this._clockStatus),this._questionScoreValue=r[this._clockStatus]}else this._questionScoreValue=1;this._time=0,this._updateClockContainer(),this._updatePointContainer(),this._clockID=setInterval(this._clockTick.bind(this),1e3)},_stopClock:function(){clearInterval(this._clockID)},_clockTick:function(){if(this._time++,"competition"===this._data.type){var t=o[this._clockStatus];t>0&&this._time>t&&(this._timeContainer.classList.remove("status"+this._clockStatus),this._clockStatus++,this._timeContainer.classList.add("status"+this._clockStatus),this._questionScoreValue=r[this._clockStatus],this._updatePointContainer())}this._updateClockContainer(!0)},_updateClockContainer:function(t){var e=String(this._time%60),i=Math.floor(this._time/60),s=":";!0===t&&(s=this._time%2==1?" ":":"),e.length<2&&(e="0"+e),this._timeContainer.textContent=i+s+e},_updatePointContainer:function(){this._questionValueContainer.textContent=String(this._questionScoreValue)},_updateScoreContainer:function(){this._scoreContainer.textContent=String(this._score)},_finishGame:function(){i.init(this._gameResult,this._score,this._timeTotal,this._data,this._gameContainer),i.showResult()},_printError:function(t){this._gameContainer.innerHTML='<div class="gameContent"><p class="error">'+t+"</p></div>"}},s}),define("Teralios/QuizCreator/Quiz",["Ajax","StringUtil","Language","Teralios/QuizCreator/Game"],function(t,e,i,s){"use strict";function n(t){this.init(t)}return n.prototype={init:function(t){this._quizContainer=t,this.quizID=Number(elData(this._quizContainer,"id")),this._gameContainer=elBySel(".game",this._quizContainer),this._gameContainer?(this._gameContainer.style.height=this._gameContainer.offsetHeight+"px",this._gameContainer.innerHTML="",this._gameContainer.classList.remove("dummy")):(this._gameContainer=elCreate("div"),this._gameContainer.className="game",this._quizContainer.appendChild(this._gameContainer)),Number.isInteger(this.quizID)||this._printError(i.get("wcf.quizMaker.quiz.error.notValidID")),this._loadData()},_loadData:function(){t.apiOnce({data:{actionName:"loadQuiz",className:"wcf\\data\\quiz\\QuizAction",objectIDs:[this.quizID]},success:this.prepareGame.bind(this),failure:function(){this._printError(i.get("wcf.quizMaker.quiz.error.loading"))}.bind(this)})},prepareGame:function(t){this._data=t.returnValues,this._initGame()},_printError:function(t){this._gameContainer.innerHTML='<div class="gameContent"><p class="error">'+e.escapeHTML(t)+"</p></div>"},_initGame:function(){this._game=new s(this._data,this._gameContainer),this._game.buildGame()}},n});