define("Teralios/QuizCreator/Result",["Ajax","Language","StringUtil"],function(t,e,i){"use strict";return{init:function(t,e,i,s,n){this._result=t,this._score=e,this._timeTotal=i,this._quizData=s,this._gameContainer=n},showResult:function(){"competition"===this._quizData.type&&1===this._quizData.isActive?this._loadResult():this._renderResultOffline()},_loadResult:function(){t.api(this,{objectIDs:[this._quizData.quizID],parameters:{score:this._score,result:this._result,timeTotal:this._timeTotal}})},_renderResultLive:function(t){this._renderBase(),this._renderScore(t)},_renderResultOffline:function(){this._renderBase()},_buildBaseContainer:function(){this._gameContainer.innerHTML='<div class="result"></div>',this._resultContainer=elBySel(".result",this._gameContainer)},_renderBase:function(){this._buildBaseContainer(),this._renderGoal()},_renderGoal:function(){var t=this._quizData.goalList,s="",n=elCreate("div");if(n.classList.add("goal"),t.length>0){for(var a=!1,o=0;o<t.length;o++)Number(t[o].points)<=Number(this._score)&&(a=t[o]);!1!==a&&(s='<span class="icon icon96 '+a.icon+'"></span>',s+='<h3 class="name">'+i.escapeHTML(a.title)+"</h3>",""!==a.description&&(s+='<p class="small">'+i.escapeHTML(a.description)+"</p>"))}else s='<h3 class="name">'+e.get("wcf.quizCreator.game.goal.none")+"</h3>",s+='<p class="small">'+e.get("wcf.quizCreator.game.goal.none.detail")+"</p>";n.innerHTML=s,this._resultContainer.appendChild(n)},_renderScore:function(t){var s='<p class="player">'+this._score+" "+e.get("wcf.quizCreator.stats.score")+"</p>";t.players>0&&(s+='<div class="others">',s+="<p>âŒ€ "+i.escapeHTML(t.averageScore)+" "+e.get("wcf.quizCreator.stats.score")+"</p>"),void 0!==t.betterAs&&t.betterAs>0?s+=e.get("wcf.quizCreator.game.result.betterAs",{percent:i.escapeHTML(t.betterAs)}):s+="<p>"+e.get("wcf.quizCreator.game.result.asGood")+"</p>",s+="</div>";var n=elCreate("div");n.classList.add("score"),n.innerHTML=s,this._resultContainer.appendChild(n)},_ajaxSetup:function(){return{data:{actionName:"finishGame",className:"wcf\\data\\quiz\\QuizAction"}}},_ajaxSuccess:function(t){this._renderResultLive(t.returnValues)},_ajaxFailure:function(){this._renderResultOffline()}}}),define("Teralios/QuizCreator/Game",["StringUtil","Language","Teralios/QuizCreator/Result"],function(t,e,i){"use strict";function s(t,e){this.init(t,e)}var n=["quizID","type","questions","questionList","goalList"],a=["A","B","C","D"],o=[10,5,1],r=[5,15,0],u=window.WCF_CLICK_EVENT;return s.prototype={init:function(t,e){this._gameContainer=e,this._data=t,this._checkData()&&(this._gameCanStart=!0)},buildGame:function(){!0===this._gameCanStart&&this._createBaseHTML()},startGame:function(){elRemove(this._buttonStart),this._buildGameHTML(),this._questionIndex=0,this._score=0,this._gameResult=[],this._timeTotal=0,this._showQuestion(!0)},answer:function(t){this._toggleButtons(!1),this._stopClock();var i=elData(t.currentTarget,"value");i===this._currentQuestion.answer?(t.currentTarget.classList.add("correct"),this._score+=this._questionScoreValue,this._updateScoreContainer()):t.currentTarget.classList.add("wrong"),this._gameResult[this._questionIndex]={answer:i,time:this._time},this._timeTotal+=this._time,this._questionIndex+1>=this._data.questions&&(this._buttonNext.textContent=e.get("wcf.quizCreator.game.finish")),this._buttonNext.style.visibility="visible",this._updateClockContainer(!1)},next:function(){this._buttonNext.style.visibility="hidden",this._questionIndex++,this._questionIndex>=this._data.questions?this._finishGame():this._showQuestion(!1)},_checkData:function(){for(var t=!1,i=n.length,s=0;s<i;s++)if(!1===this._data.hasOwnProperty(n[s])){t=!0;break}return 0===this._data.questionList.length&&(t=!0),!0===t&&this._printError(e.get("wcf.quizCreator.game.data.missing")),!t},_createBaseHTML:function(){this._headerContainer=elCreate("div"),this._contentContainer=elCreate("div"),this._footerContainer=elCreate("div"),this._headerContainer.className="gameHeader",this._contentContainer.className="gameContent",this._footerContainer.className="gameFooter",this._gameContainer.innerHTML="",this._gameContainer.appendChild(this._headerContainer),this._gameContainer.appendChild(this._contentContainer),this._gameContainer.appendChild(this._footerContainer),this._buttonStart=elCreate("button"),this._buttonStart.textContent=e.get("wcf.quizCreator.game.start"),this._buttonStart.addEventListener(u,this.startGame.bind(this)),this._contentContainer.appendChild(this._buttonStart)},_buildGameHTML:function(){var t="<b>"+e.get("wcf.quizCreator.stats.questions")+"</b> ";t+='<span class="currentQuestion"> '+this._questionIndex+"</span> / "+this._data.questions;var i=elCreate("div");i.className="questionCounter",i.innerHTML=t,this._questionCounterContainer=elBySel(".currentQuestion",i),this._headerContainer.appendChild(i);var s=elCreate("div");s.className="clock",s.innerHTML="<b>"+e.get("wcf.quizCreator.stats.time")+':</b> <span class="seconds"></span> ',this._timeContainer=elBySel(".seconds",s),this._headerContainer.appendChild(s);var n=elCreate("div");n.className="currentQuestionValue",n.innerHTML='+ <span class="questionValue"></span> <b>'+e.get("wcf.quizCreator.stats.points")+"</b>",this._questionValueContainer=elBySel(".questionValue",n),this._headerContainer.appendChild(n),this._footerContainer.innerHTML='<p><span class="score"></span> '+e.get("wcf.quizCreator.stats.score")+"</p>",this._scoreContainer=elBySel(".score",this._footerContainer),this._questionText=elCreate("p");var a=elCreate("div");a.className="question",a.appendChild(this._questionText),elHide(a),this._contentContainer.appendChild(a),this._answerList=this._buildQuestionField(),elHide(this._answerList),this._contentContainer.appendChild(this._answerList),this._buttonNext=elCreate("button"),this._buttonNext.textContent=e.get("wcf.quizCreator.game.next"),this._buttonNext.addEventListener(u,this.next.bind(this)),this._buttonNext.style.visibility="hidden",this._contentContainer.appendChild(this._buttonNext)},_buildQuestionField:function(){var t=elCreate("ul");t.className="answerList",shuffle(a),this._buttons=[];for(var e=0;e<4;e++){var i=a[e],s=elCreate("button");s.className="answer",elData(s,"value",i),s.addEventListener(u,this.answer.bind(this));var n=elCreate("li");n.appendChild(s),t.appendChild(n),this._buttons[e]=s}return t},_toggleButtons:function(t){for(var e=0;e<4;e++)!0===t?(this._buttons[e].removeAttribute("disabled"),this._buttons[e].classList.remove("wrong","correct")):this._buttons[e].setAttribute("disabled","disabled")},_showQuestion:function(t){!0===t&&(elShow(this._questionText.parentElement),elShow(this._answerList),this._contentContainer.classList.add("borderTop"),this._footerContainer.classList.add("borderTop"),this._updateScoreContainer()),this._currentQuestion=this._data.questionList[this._questionIndex],this._questionText.textContent=this._currentQuestion.question;for(var e=0;e<4;e++){var i="option"+elData(this._buttons[e],"value");this._buttons[e].textContent=this._currentQuestion[i]}this._toggleButtons(!0),this._questionCounterContainer.textContent=String(this._questionIndex+1),this._startClock()},_startClock:function(){if("competition"===this._data.type){for(var t=1;t<=3;t++)this._timeContainer.classList.remove("status"+t);this._clockStatus=0,this._timeContainer.classList.add("status"+this._clockStatus),this._questionScoreValue=o[this._clockStatus]}else this._questionScoreValue=1;this._time=0,this._updateClockContainer(),this._updatePointContainer(),this._clockID=setInterval(this.clockTick.bind(this),1e3)},_stopClock:function(){clearInterval(this._clockID)},clockTick:function(){if(this._time++,"competition"===this._data.type){var t=r[this._clockStatus];t>0&&this._time>t&&(this._timeContainer.classList.remove("status"+this._clockStatus),this._clockStatus++,this._timeContainer.classList.add("status"+this._clockStatus),this._questionScoreValue=o[this._clockStatus],this._updatePointContainer())}this._updateClockContainer(!0)},_updateClockContainer:function(t){var e=String(this._time%60),i=Math.floor(this._time/60),s=":";!0===t&&(s=this._time%2==1?" ":":"),e.length<2&&(e="0"+e),this._timeContainer.textContent=i+s+e},_updatePointContainer:function(){this._questionValueContainer.textContent=String(this._questionScoreValue)},_updateScoreContainer:function(){this._scoreContainer.textContent=String(this._score)},_finishGame:function(){i.init(this._gameResult,this._score,this._timeTotal,this._data,this._gameContainer),i.showResult()},_printError:function(t){this._gameContainer.innerHTML='<div class="gameContent"><p class="error">'+t+"</p></div>"}},s}),define("Teralios/QuizCreator/Quiz",["Ajax","StringUtil","Language","Teralios/QuizCreator/Game"],function(t,e,i,s){"use strict";function n(t){this.init(t)}return n.prototype={init:function(t){this._gameContainer=t,this.quizID=Number(elData(this._gameContainer,"quiz-id")),this._gameFieldContainer=elBySel(".gameField",this._gameContainer),this._gameFieldContainer?(this._gameContainer.style.height=this._gameContainer.offsetHeight+"px",this._gameFieldContainer.innerHTML="",this._gameFieldContainer.classList.remove("dummy")):(this._gameFieldContainer=elCreate("div"),this._gameFieldContainer.className="gameField",this._gameContainer.appendChild(this._gameFieldContainer)),Number.isInteger(this.quizID)||this._printError(i.get("wcf.quizCreator.quiz.id.invalid")),this._loadData()},_loadData:function(){t.apiOnce({data:{actionName:"loadQuiz",className:"wcf\\data\\quiz\\QuizAction",objectIDs:[this.quizID]},success:this.prepareGame.bind(this),failure:function(){this._printError(i.get("wcf.quizCreator.quiz.loading.error"))}.bind(this)})},prepareGame:function(t){this._data=t.returnValues,this._initGame()},_printError:function(t){this._gameFieldContainer.innerHTML='<div class="gameContent"><p class="error">'+e.escapeHTML(t)+"</p></div>"},_initGame:function(){this._game=new s(this._data,this._gameFieldContainer),this._game.buildGame()}},n}),define("Teralios/QuizCreator/Acp/ActionReset",["Ajax","Ui/Confirmation","Language"],function(t,e,i){"use strict";var s=window.WCF_CLICK_EVENT;return{init:function(t,e,i){this._dboActionClass=t,this._selector=e,this._buttonSelector=".jsResetMatchesButton",this._isButton=void 0!==i,this._buildClick()},confirm:function(){t.api(this,{objectIDs:[this._targetID]})},click:function(t){var s=t.currentTarget;this._targetID=elData(s,"object-id"),this._confirmMessage=elData(s,"confirm-message-html"),void 0!==this._confirmMessage&&""!==this._confirmMessage||(this._confirmMessage=i.get("wcf.acp.quizCreator.matches.reset.confirm")),e.show({confirm:this.confirm.bind(this),message:this._confirmMessage,messageIsHtml:!0})},addEvent:function(t){if(this._isButton)t.addEventListener(s,this.click.bind(this));else{var e=elBySel(this._buttonSelector,t);null!==e&&e.addEventListener(s,this.click.bind(this))}},_buildClick:function(){var t=elBySelAll(this._selector);forEach(t,this.addEvent.bind(this))},_ajaxSetup:function(){return{data:{actionName:"resetGames",className:this._dboActionClass}}}}}),define("Teralios/QuizCreator/Dialog/Player",["Ajax","Ui/Dialog","Language"],function(t,e,i){"use strict";var s=window.WCF_CLICK_EVENT;return{init:function(){this._button=elById("showUserResult"),this.gameID=elData(this._button,"game-id"),this._loadTPL()},getData:function(t){this.tpl=t.returnValues,this._buildButton()},getHtml:function(){return this.tpl},showDialog:function(){e.open(this)},_loadTPL:function(){t.apiOnce({data:{actionName:"showResult",className:"wcf\\data\\quiz\\game\\GameAction",objectIDs:[this.gameID]},success:this.getData.bind(this)})},_buildButton:function(){this._button.addEventListener(s,this.showDialog.bind(this))},_dialogSetup:function(){var t=i.get("wcf.quizCreator.user.play.details.dialog.title");return{id:"playerResult",source:this.getHtml(),options:{title:t}}}}});