define("Teralios/Quiz/Quiz",["Ajax","StringUtil","Language"],function(t,e,s){"use strict";function i(t,e){this.init(t,e)}var n=[10,5,1],a=[5,15,0],r=["stage0","stage1","stage2"];return i.prototype={init:function(e,s){this.quizID=elData(e,"id"),this.currentStage=this.time=0,this.currentQuestionKey=1,this.currentScore=0,this.currentQuestionValue=n[this.currentStage],this.isCompetition=s,this._container=e,this._gameHeader=elBySel(".quizGameHeader",this._container),this._gameContent=elBySel(".quizGameContent",this._container),this._gameFooter=elBySel(".quizGameFooter",this._container),this._loadingOverlay=elCreate("div"),this._loadingOverlay.className="quizLoadingOverlay",this._loadingOverlay.innerHTML='<span class="icon icon96 fa-spinner"></span>',this._gameContent.classList.add("loading"),this._gameContent.appendChild(this._loadingOverlay),t.api(this)},startGame:function(){var t,i,n,a,r,o,u,h;for(elRemove(elBySel(".quizStart",this._gameContent)),t="",t+='<div class="questionCounter"><b>'+s.get("wcf.quizMaker.play.question")+"</b>",t+='<span class="currentQuestionKey"> '+this.currentQuestionKey+"</span> / "+e.escapeHTML(this.questions)+"</div>",t+='<div class="questionTime"><b>'+s.get("wcf.quizMaker.play.time")+'</b> <span class="secondsPlayed"></span></div>',t+='<div class="questionPoints"></div>',this._gameHeader.innerHTML=t,i="",i+='<p><span class="score">'+this.currentScore+"</span> <b>"+s.get("wcf.quizMaker.play.points")+"</b></p>",this._gameFooter.innerHTML=i,n=elCreate("div"),n.className="question",this._buttonNext=elCreate("button"),this._buttonNext.innerHTML=s.get("wcf.quizMaker.play.next"),this._buttonNext.addEventListener(WCF_CLICK_EVENT,this.nextQuestion.bind(this)),this._answerList=elCreate("ul"),this._answerList.className="answerList",a=["A","B","C","D"],this._buttons={},r=0;r<4;r++)o=a[r],u=elCreate("button"),u.className="answer",elData(u,"value",o),u.addEventListener(WCF_CLICK_EVENT,this.answer.bind(this)),h=elCreate("li"),h.appendChild(u),this._answerList.appendChild(h),this._buttons[o]=u;elHide(this._answerList),elHide(this._buttonNext),this._gameContent.appendChild(n),this._gameContent.appendChild(this._answerList),this._gameContent.appendChild(this._buttonNext),this._gameContent.classList.add("borderTop"),this._gameFooter.classList.add("borderTop"),this._updatePoints(10),this._updateTime(),this.nextQuestion()},answer:function(t){var e,i,n;this.stopCycle(),e=t.target,i=elData(e,"value"),n=this.currentQuestion,n.answer===i?(e.classList.add("correctAnswer"),this.currentScore+=this.currentQuestionValue):e.classList.add("wrongAnswer"),this._buttons.A.setAttribute("disabled","disabled"),this._buttons.B.setAttribute("disabled","disabled"),this._buttons.C.setAttribute("disabled","disabled"),this._buttons.D.setAttribute("disabled","disabled"),this.currentQuestionKey++,this.currentQuestionKey>this.questions?(this.currentQuestionKey--,this.updateGameInformation(),elRemove(this._answerList),elRemove(this._buttonNext),this._gameContent.innerHTML="<p>"+s.get("wcf.quizMaker.play.temp.finished")+"</p>"):elShow(this._buttonNext)},nextQuestion:function(){var t,i;elHide(this._buttonNext),elHide(this._answerList),t=this.currentQuestionKey-1,t in this.questionList?(this.updateGameInformation(),i=this.questionList[t],elBySel(".question",this._gameContent).innerHTML=e.escapeHTML(i.question),this._buttons.A.innerHTML=e.escapeHTML(i.optionA),this._buttons.B.innerHTML=e.escapeHTML(i.optionB),this._buttons.C.innerHTML=e.escapeHTML(i.optionC),this._buttons.D.innerHTML=e.escapeHTML(i.optionD),this._buttons.A.removeAttribute("disabled"),this._buttons.B.removeAttribute("disabled"),this._buttons.C.removeAttribute("disabled"),this._buttons.D.removeAttribute("disabled"),this._buttons.A.classList.remove("correctAnswer","wrongAnswer"),this._buttons.B.classList.remove("correctAnswer","wrongAnswer"),this._buttons.C.classList.remove("correctAnswer","wrongAnswer"),this._buttons.D.classList.remove("correctAnswer","wrongAnswer"),this.currentQuestion=i,elShow(this._answerList),this.startCycle()):this._gameContent.innerHTML='<p class="error">'+s.get("wcf.quizMaker.play.loadError")+"</p>"},startCycle:function(){this._updateTime(),this._updatePoints(n[this.currentStage]),elBySel(".secondsPlayed",this._gameHeader).classList.remove("stage0","stage1","stage2"),elBySel(".secondsPlayed",this._gameHeader).classList.add(r[this.currentStage]),this.intervalID=setInterval(this._timeWatch.bind(this),1e3)},stopCycle:function(){clearInterval(this.intervalID),this.time=this.currentStage=0},_timeWatch:function(){var t,e;this.time++,t=a[this.currentStage],t>0&&this.time>t&&(this.currentStage++,e=elBySel(".secondsPlayed",this._gameHeader),e.classList.remove(r[this.currentStage-1]),e.classList.add(r[this.currentStage]),this._updatePoints(n[this.currentStage])),this._updateTime()},updateGameInformation:function(){elBySel(".currentQuestionKey",this._gameHeader).innerHTML=this.currentQuestionKey,elBySel(".score",this._gameFooter).innerHTML=this.currentScore},_updatePoints:function(t){this.currentQuestionValue=t,elBySel(".questionPoints",this._gameHeader).innerHTML="+"+t+" <b>"+s.get("wcf.quizMaker.play.points")+"</b>"},_updateTime:function(){var t=String(this.time%60),e=Math.floor(this.time/60);t.length<2&&(t="0"+t),elBySel(".secondsPlayed",this._gameHeader).innerHTML=e+":"+t},_ajaxSetup:function(){return{data:{actionName:"loadQuiz",className:"wcf\\data\\quiz\\QuizAction",objectIDs:[this.quizID]}}},_ajaxSuccess:function(t){this.quiz=t.returnValues,this.questions=this.quiz.questions,this.questionList=this.quiz.questionList,this.goalList=this.quiz.goalList,this._gameContent.classList.remove("loading"),elRemove(this._loadingOverlay);var e=elCreate("button");e.className="quizStart",e.addEventListener(WCF_CLICK_EVENT,this.startGame.bind(this)),e.innerHTML=s.get("wcf.quizMaker.play.start"),this._gameContent.appendChild(e)},_ajaxFailure:function(){this._gameContent.classList.remove("loading"),elRemove(this._loadingOverlay),this._gameContent.innerHTML='<p class="error">'+s.get("wcf.quizMaker.play.loadError")+"</p>"}},i});