define("Teralios/QuizMaker/Game",["Ajax","StringUtil","Language"],function(t,e,i){"use strict";function n(t,e){this.init(t,e)}var s=["quizID","type","questions","questionList","goalList"],a=["A","B","C","D"],o=[10,5,1],r=[5,15,0];return n.prototype={init:function(t,e){this._gameContainer=e,this._data=t,this._checkData()&&this._createBaseHTML()},startGame:function(){elRemove(this._buttonStart),this._buildGameHTML(),this._questionIndex=0,this._score=0,this._showQuestion(!0)},answer:function(t){this._toggleButtons(!1),this._stopClock(),elData(t.target,"value")===this._currentQuestion.answer?(t.target.classList.add("correct"),this._score+=this._questionScoreValue,this._updateScoreContainer()):t.target.classList.add("wrong"),this._buttonNext.style.visibility="visible",this._updateClockContainer(!1)},next:function(){this._buttonNext.style.visibility="hidden",this._questionIndex++,this._questionIndex>=this._data.questions?this._finishGame():this._showQuestion(!1)},_checkData:function(){for(var t=!1,e=s.length,n=0;n<e;n++)if(!1===this._data.hasOwnProperty(s[n])){t=!0;break}return!0===t&&this._printError(i.get("wcf.quizMaker.game.missingData")),!t},_createBaseHTML:function(){this._headerContainer=elCreate("div"),this._contentContainer=elCreate("div"),this._footerContainer=elCreate("div"),this._headerContainer.className="gameHeader",this._contentContainer.className="gameContent",this._footerContainer.className="gameFooter",this._gameContainer.innerHTML="",this._gameContainer.appendChild(this._headerContainer),this._gameContainer.appendChild(this._contentContainer),this._gameContainer.appendChild(this._footerContainer),this._buttonStart=elCreate("button"),this._buttonStart.textContent=i.get("wcf.quizMaker.game.start"),this._buttonStart.addEventListener(WCF_CLICK_EVENT,this.startGame.bind(this)),this._contentContainer.appendChild(this._buttonStart)},_buildGameHTML:function(){var t="<b>"+i.get("wcf.quizMaker.game.questions")+"</b> ";t+='<span class="currentQuestion"> '+this._questionIndex+"</span> / "+this._data.questions;var e=elCreate("div");e.className="questionCounter",e.innerHTML=t,this._questionCounterContainer=elBySel(".currentQuestion",e),this._headerContainer.appendChild(e);var n=elCreate("div");n.className="clock",n.innerHTML="<b>"+i.get("wcf.quizMaker.game.time")+'</b> <span class="seconds"></span> ',this._timeContainer=elBySel(".seconds",n),this._headerContainer.appendChild(n);var s=elCreate("div");s.className="currentQuestionValue",s.innerHTML='+ <span class="questionValue"></span> <b>'+i.get("wcf.quizMaker.game.points")+"</b>",this._questionValueContainer=elBySel(".questionValue",s),this._headerContainer.appendChild(s),this._footerContainer.innerHTML='<p><span class="score"></span> '+i.get("wcf.quizMaker.game.score")+"</p>",this._scoreContainer=elBySel(".score",this._footerContainer),this._questionText=elCreate("p"),this._questionText.className="question",elHide(this._questionText),this._contentContainer.appendChild(this._questionText),this._answerList=this._buildQuestionField(),elHide(this._answerList),this._contentContainer.appendChild(this._answerList),this._buttonNext=elCreate("button"),this._buttonNext.textContent=i.get("wcf.quizMaker.game.next"),this._buttonNext.addEventListener(WCF_CLICK_EVENT,this.next.bind(this)),this._buttonNext.style.visibility="hidden",this._contentContainer.appendChild(this._buttonNext)},_buildQuestionField:function(){var t=elCreate("ul");t.className="answerList",shuffle(a),this._buttons=[];for(var e=0;e<4;e++){var i=a[e],n=elCreate("button");n.className="answer",elData(n,"value",i),n.addEventListener(WCF_CLICK_EVENT,this.answer.bind(this));var s=elCreate("li");s.appendChild(n),t.appendChild(s),this._buttons[e]=n}return t},_toggleButtons:function(t){for(var e=0;e<4;e++)!0===t?(this._buttons[e].removeAttribute("disabled"),this._buttons[e].classList.remove("wrong","correct")):this._buttons[e].setAttribute("disabled","disabled")},_showQuestion:function(t){!0===t&&(elShow(this._questionText),elShow(this._answerList),this._contentContainer.classList.add("borderTop"),this._footerContainer.classList.add("borderTop"),this._updateScoreContainer()),this._currentQuestion=this._data.questionList[this._questionIndex],this._questionText.textContent=e.escapeHTML(this._currentQuestion.question);for(var i=0;i<4;i++){var n="option"+elData(this._buttons[i],"value");this._buttons[i].textContent=e.escapeHTML(this._currentQuestion[n])}this._toggleButtons(!0),this._questionCounterContainer.textContent=String(this._questionIndex+1),this._startClock()},_startClock:function(){if("competition"===this._data.type){for(var t=1;t<=3;t++)this._timeContainer.classList.remove("status"+t);this._clockStatus=0,this._timeContainer.classList.add("status"+this._clockStatus),this._questionScoreValue=o[this._clockStatus]}else this._questionScoreValue=1;this._time=0,this._updateClockContainer(),this._updatePointContainer(),this._clockID=setInterval(this._clockTick.bind(this),1e3)},_stopClock:function(){clearInterval(this._clockID)},_clockTick:function(){if(this._time++,"competition"===this._data.type){var t=r[this._clockStatus];t>0&&this._time>t&&(this._timeContainer.classList.remove("status"+this._clockStatus),this._clockStatus++,this._timeContainer.classList.add("status"+this._clockStatus),this._questionScoreValue=o[this._clockStatus],this._updatePointContainer())}this._updateClockContainer(!0)},_updateClockContainer:function(t){var e=String(this._time%60),i=Math.floor(this._time/60),n=":";!0===t&&(n=this._time%2==1?" ":":"),e.length<2&&(e="0"+e),this._timeContainer.textContent=i+n+e},_updatePointContainer:function(){this._questionValueContainer.textContent=String(this._questionScoreValue)},_updateScoreContainer:function(){this._scoreContainer.textContent=String(this._score)},_finishGame:function(){},_printError:function(t){this._gameContainer.innerHTML='<div class="gameContent"><p class="error">'+t+"</p></div>"}},n}),define("Teralios/QuizMaker/Quiz",["Ajax","StringUtil","Language","Teralios/QuizCreator/Game"],function(t, e, i, n){"use strict";function s(t){this.init(t)}return s.prototype={init:function(t){this._quizContainer=t,this.quizID=Number(elData(this._quizContainer,"id")),this._gameContainer=elBySel(".game",this._quizContainer),this._gameContainer?(this._gameContainer.style.height=this._gameContainer.offsetHeight+"px",this._gameContainer.innerHTML="",this._gameContainer.classList.remove("dummy")):(this._gameContainer=elCreate("div"),this._gameContainer.className="game",this._quizContainer.appendChild(this._gameContainer)),Number.isInteger(this.quizID)||this._printError(i.get("wcf.quizMaker.quiz.error.notValidID")),this._loadData()},_loadData:function(){t.apiOnce({data:{actionName:"loadQuiz",className:"wcf\\data\\quiz\\QuizAction",objectIDs:[this.quizID]},success:this.prepareGame.bind(this),failure:function(){this._printError(i.get("wcf.quizMaker.quiz.error.loading"))}.bind(this)})},prepareGame:function(t){new n(t.returnValues,this._gameContainer)},_printError:function(t){this._gameContainer.innerHTML='<div class="gameContent"><p class="error">'+e.escapeHTML(t)+"</p></div>"}},s});